<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ” El Impostor</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <audio id="bgMusic" loop><source src="musica.mp3" type="audio/mpeg"></audio>

  <div id="volumeControl">
    <span>ğŸ”Š</span>
    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.3">
  </div>

<section id="agradecimientos" class="screen active">
    <h1>AGRADECIMIENTOS</h1>

    <p><strong>ğŸ‘©â€ğŸ’» Desarrolladores:</strong><br>
      Gabriela Lopez<br>
      Elian Garcia
    </p>

    <p><strong>ğŸ¹ MÃºsica:</strong><br>Victor Zerpa</p>

    <p><strong>ğŸ¨ Arte y AnimaciÃ³n:</strong><br>
      Arianna Escalona
    </p>

    <p class="thanks">
      Agradecimientos especiales ğŸ¥º al Profesor
      <strong>Gabriel Baute</strong>
      por guiarnos en el desarrollo de este proyecto ğŸ¤ ğŸ¤
    </p>

    <button id="btnContinuar" onclick="mostrarPantalla('inicio')">Continuar</button>
  </section>

  <section id="inicio" class="screen">
    <h1>ğŸ” EL IMPOSTOR ğŸ•µï¸</h1>
    <button class="btn-principal" onclick="mostrarPantalla('jugadores')">Jugar Local</button>

    <div class="dropdown" style="margin-top: 20px;">
      <button class="btn-dropdown" id="btnMenuOnline">ğŸŒ Modo Online â–¼</button>
      <div class="dropdown-content" id="menuOnlineContent">
        <button onclick="mostrarPantalla('onlineConnect'); crearSala();">â• Crear sala</button>
        <button onclick="mostrarPantalla('onlineConnect'); abrirPanelUnirse();">ğŸ”— Unirse a sala</button>
      </div>
    </div>
  </section>

  <section id="jugadores" class="screen">
    <h2>Jugadores (2 a 10)</h2>
    <input type="text" id="nombreJugador" placeholder="Nombre del jugador" autocomplete="off">
    <button id="btnAgregarJugador">Agregar</button>
    <ul id="listaJugadores"></ul>
    <button id="btnContinuarCategorias">Continuar</button>
  </section>

  <section id="onlineConnect" class="screen">
    <h2>ğŸ® Sala Online</h2>
    <div id="onlineRoomControls">
      <button id="btnCrearSalaOnline" onclick="crearSala()">â• Crear sala</button>
      <button id="btnUnirseSalaOnline" onclick="abrirPanelUnirse()">ğŸ”— Unirse a sala</button>
    </div>
    
    <div id="onlineRoomInfo" style="display: none;">
      <p>CÃ³digo de sala: <strong id="onlineRoomCode" style="font-size: 1.5rem; color: #f59e0b;">---</strong></p>
      <p>Conectados:</p>
      <ul id="listaJugadoresOnline"></ul>
      <button id="btnAgregarAJugadores" style="background: #10b981;">â• Agregar a la partida</button>
      <button onclick="location.reload()" style="background: #ef4444;">ğŸšª Salir</button>
    </div>

    <div id="onlineJoinPanel" style="display: none;">
      <input type="text" id="onlineRoomCodeInput" placeholder="CÃ³digo de 6 dÃ­gitos" maxlength="6">
      <button onclick="confirmarUnion()">Entrar</button>
      <button onclick="location.reload()">Cancelar</button>
    </div>
    <br>
    <button onclick="mostrarPantalla('inicio')">â¬… Volver</button>
  </section>

  <section id="categorias" class="screen"><h2>CategorÃ­a</h2><select id="selectCategoria"><option value="comida">Comida</option><option value="lugares">Lugares</option><option value="animales">Animales</option></select><button id="btnAsignarPalabras">Empezar</button></section>
  <section id="palabra" class="screen"><h2 id="turnoJugador"></h2><div id="palabraSecreta" class="blur">VER</div><button id="btnSiguienteJugador">Siguiente</button></section>
  <section id="temporizador" class="screen"><h2>Tiempo</h2><div id="tiempo">2:00</div></section>
  <section id="votacion" class="screen"><h2>VotaciÃ³n</h2><div id="opcionesVoto"></div></section>
  <section id="resultado" class="screen"><div id="resultadoTexto"></div></section>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
  <script src="palabras.js"></script>
  <script src="script.js"></script>

  <script>
    // === CONFIGURACIÃ“N CON TUS CREDENCIALES ===
    const firebaseConfig = {
      apiKey: "AIzaSyCR8AoEFuaXg25REIIQngJC-c-a3siCI2g",
      authDomain: "impostorgame-ba302.firebaseapp.com",
      projectId: "impostorgame-ba302",
      storageBucket: "impostorgame-ba302.firebasestorage.app",
      messagingSenderId: "935254268468",
      appId: "1:935254268468:web:1f6359f77713636f608861",
      measurementId: "G-RR7C2N42JB"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let onlineRoomId = null;
    let onlinePlayerName = "";
    let isHost = false;

    // --- FUNCIONES ONLINE ---
    window.crearSala = async () => {
      onlineRoomId = Math.floor(100000 + Math.random() * 900000).toString();
      onlinePlayerName = "AnfitriÃ³n";
      isHost = true;
      await db.collection("salas").doc(onlineRoomId).set({
        jugadores: [onlinePlayerName],
        creada: firebase.firestore.FieldValue.serverTimestamp()
      });
      escucharSala();
      actualizarUIOnline();
    };

    window.abrirPanelUnirse = () => {
      document.getElementById('onlineJoinPanel').style.display = 'block';
      document.getElementById('onlineRoomControls').style.display = 'none';
    };

    window.confirmarUnion = async () => {
      const codigo = document.getElementById('onlineRoomCodeInput').value;
      const nombre = prompt("Tu nombre:");
      if (!nombre) return;
      
      const salaRef = db.collection("salas").doc(codigo);
      const doc = await salaRef.get();
      if (doc.exists) {
        await salaRef.update({ jugadores: firebase.firestore.FieldValue.arrayUnion(nombre) });
        onlineRoomId = codigo;
        onlinePlayerName = nombre;
        escucharSala();
        actualizarUIOnline();
      } else { alert("Sala no encontrada"); }
    };

    function escucharSala() {
      db.collection("salas").doc(onlineRoomId).onSnapshot(doc => {
        if (doc.exists) {
          const lista = document.getElementById('listaJugadoresOnline');
          lista.innerHTML = "";
          doc.data().jugadores.forEach(j => {
            const li = document.createElement('li');
            li.textContent = j;
            lista.appendChild(li);
          });
        }
      });
    }

    function actualizarUIOnline() {
      document.getElementById('onlineRoomInfo').style.display = 'block';
      document.getElementById('onlineRoomControls').style.display = 'none';
      document.getElementById('onlineJoinPanel').style.display = 'none';
      document.getElementById('onlineRoomCode').textContent = onlineRoomId;
    }

    document.getElementById('btnAgregarAJugadores').onclick = () => {
      const items = document.querySelectorAll('#listaJugadoresOnline li');
      items.forEach(li => {
        if (!window.jugadores.includes(li.textContent)) {
          window.jugadores.push(li.textContent);
          window.puntuaciones[li.textContent] = 0;
        }
      });
      window.renderJugadores();
      mostrarPantalla('jugadores');
    };
  </script>
</body>
</html>